<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Upload Avatar</title>
    <style>
      body {
        font-family: Arial;
        margin: 40px;
      }
      #preview {
        width: 150px;
        height: 150px;
        border: 2px dashed #999;
        border-radius: 50%;
        margin-bottom: 20px;
        object-fit: cover;
      }
      input,
      button {
        display: block;
        margin-bottom: 15px;
        padding: 8px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <h2>Đăng nhập để Upload Avatar</h2>

    <!DOCTYPE html>

    <html lang="vi">
      <head>
        <meta charset="UTF-8" />
        <title>Upload Nhiều Ảnh</title>
        <style>
          body {
            font-family: Arial, sans-serif;
            margin: 40px;
          }
          h2,
          h3 {
            color: #333;
          }
          #previewContainer {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            margin-bottom: 20px;
          }
          .preview {
            width: 120px;
            height: 120px;
            border: 2px dashed #aaa;
            border-radius: 10px;
            object-fit: cover;
          }
          input,
          button {
            display: block;
            margin-bottom: 15px;
            padding: 8px;
            font-size: 16px;
          }
        </style>
      </head>
      <body>
        <h2>Đăng nhập để Upload Nhiều Ảnh</h2>

        ```
        <div id="loginForm">
          <input type="text" id="username" placeholder="Username" />
          <input type="password" id="password" placeholder="Password" />
          <button id="loginBtn">Đăng nhập</button>
        </div>

        <div id="uploadSection" style="display: none">
          <h3>Upload Nhiều Ảnh</h3>
          <input type="file" id="imageInput" accept="image/*" multiple />
          <div id="previewContainer"></div>
          <button id="uploadBtn">Upload</button>
          <p id="status"></p>
        </div>

        <script>
          let authToken = "";

          // ==== ĐĂNG NHẬP ====
          document
            .getElementById("loginBtn")
            .addEventListener("click", async () => {
              const username = document.getElementById("username").value.trim();
              const password = document.getElementById("password").value.trim();

              const res = await fetch("http://localhost:3000/auth/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username, password }),
              });

              const data = await res.json();
              if (data.success) {
                authToken = data.data.startsWith("Bearer")
                  ? data.data
                  : "Bearer " + data.data;

                alert("Đăng nhập thành công!");
                document.getElementById("loginForm").style.display = "none";
                document.getElementById("uploadSection").style.display =
                  "block";
              } else {
                alert("Sai tài khoản hoặc mật khẩu!");
              }
            });

          // ==== HIỂN THỊ ẢNH XEM TRƯỚC ====
          document
            .getElementById("imageInput")
            .addEventListener("change", (e) => {
              const files = e.target.files;
              const container = document.getElementById("previewContainer");
              container.innerHTML = ""; // Xóa preview cũ

              Array.from(files).forEach((file) => {
                const img = document.createElement("img");
                img.classList.add("preview");
                img.src = URL.createObjectURL(file);
                container.appendChild(img);
              });
            });

          // ==== UPLOAD NHIỀU ẢNH ====
          document
            .getElementById("uploadBtn")
            .addEventListener("click", async () => {
              const fileInput = document.getElementById("imageInput");
              if (!fileInput.files.length) {
                alert("Vui lòng chọn ít nhất 1 ảnh!");
                return;
              }

              const formData = new FormData();
              Array.from(fileInput.files).forEach((file) => {
                formData.append("image", file); // phải cùng tên field "image"
              });

              const res = await fetch(
                "http://localhost:3000/files/uploadMulti",
                {
                  method: "POST",
                  headers: {
                    Authorization: authToken,
                  },
                  body: formData,
                }
              );

              const data = await res.json();
              if (data.success) {
                document.getElementById("status").innerHTML =
                  "Upload thành công!<br>" +
                  data.data
                    .map(
                      (url) =>
                        `<a href="http://localhost:3000${url}" target="_blank">${url}</a>`
                    )
                    .join("<br>");
                alert("Upload thành công!");
              } else {
                alert(
                  "Lỗi upload: " + (data.data?.message || "Không xác định")
                );
              }
            });
        </script>
      </body>
    </html>
  </body>
</html>
